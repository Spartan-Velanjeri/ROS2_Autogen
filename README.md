# ROS_Autogen

[![License](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

## Description

Generates packages with launch files automatically from URDF for ROS2 with your required simulator. Built to view URDF quickly on RViz and Gazebo.
Currently supports **[Ignition Gazebo Fortress](https://gazebosim.org/docs/fortress/tutorials)** and **[Gazebo Classic](https://classic.gazebosim.org)** .

Also adds both **[Robot_state_publisher](https://index.ros.org/p/robot_state_publisher/github-ros-robot_state_publisher)**, **[Joint_state_publisher](https://index.ros.org/p/joint_state_publisher/)** and **[joint_state_publisher_gui](https://index.ros.org/p/joint_state_publisher_gui/github-ros-joint_state_publisher/)** if required to test your robot.

## Table of Contents

- [Installation](#installation)
- [Usage](#usage)
- [Contributing](#contributing)
- [Upcoming Features](#Upcoming_Features)
- [Troubleshooting](#Troubleshooting)

## Installation

This project has been tested with Ubuntu 22.04. To install the necessary components, follow these steps:

- **ROS2 Humble Hawksbill:**  
  Follow the installation instructions for ROS2 Humble Hawksbill from [here](https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html).

- **Ignition Gazebo Fortress:**  
  Install Ignition Gazebo Fortress by following the steps outlined [here](https://gazebosim.org/docs/fortress/install_ubuntu).


An easier way to install both ROS2 and Ignition Gazebo Fortress is to use `apt`:

```bash
sudo apt-get install ros-humble-desktop-full
```

Also if you would like to test the joint-states of your robot, don't forget to install joint-state-publisher-gui with 

```bash
sudo apt-get install ros-humble-joint-state-publisher-gui
```

Also do install the [send2trash](https://pypi.org/project/Send2Trash/) python library as it'll allow you to quickly send your older, redundant package to trash if you are creating a new one with the same name.

```bash
pip install send2trash
```

## Usage

### Linux

To utilize this project, follow these steps:

1. **Clone the repository:**  
   Clone this repository and copy your URDF file or folder into the cloned repository inside the urdf folder. If you have meshes required with your URDF, copy them too inside the meshes folder

2. **Run the main.py file:**
   Execute the following command in your terminal:
   ```bash
   python3 main.py 

3.  **Provide package name and URDF path:**
    When prompted, enter your package name (IMPORTANT: Make sure to name it with the **same pkg name** as present in the URDF file especially if the URDF file points to other resources(meshes,other urdfs) with the pkg name as path) and copy the RELATIVE path of the URDF present inside the repository (usually urdf/your_urdf.urdf). This will generate your ROS2 package inside the repository.

4.  **Copy the package into your workspace:**
    Once the package is generated, copy it into your ROS2 workspace, then build and launch it.

###  Docker 

To run the demo with GUI we are going to use [Rocker](https://github.com/osrf/rocker/) which is a tool to run docker images with customized local support injected for things like nvidia support. Rocker also supports user id specific files for cleaner mounting file permissions. You can install this tool with the following [instructions](https://github.com/osrf/rocker/#installation). Make sure you meet all of the [prerequisites](https://github.com/osrf/rocker/#prerequisites).


1. **Clone the repository:**  
   Copy your URDF file or folder into the cloned repository inside the urdf folder. If you have meshes required with your URDF, copy them too inside the meshes folder

2. **Build the Dockerfile:** Navigate into the repo and run
    ```bash
    docker build . -t image_name
    ```


3. **Run the docker:** The following commands will open the main program which generates the pkg. Replace path_of_ros_autogen_on_your_host with the actual path.

    ```bash 
    rocker --x11 --nvidia --name ros_autogen image_name --volume /path_of_ros_autogen_on_your_host:/ros_autogen_runner
    ```

4. **Run the Script and provide package name and URDF path:**

    ```bash
    python3 main.py
    ```
    When prompted, enter your package name and copy the RELATIVE path of the URDF present inside the repository (usually urdf/your_urdf.urdf). This will generate your ROS2 package inside the repository.

5. **Launch your Package:** In another terminal, run the following commands. Replace package_name with your ros2_pkg generated by the autogen.

    ```bash
    cp -r package_name /ros2_ws/src
    cd /ros2_ws
    colcon build
    source install/setup.bash
    ros2 launch package_name package_name.launch.py
    ```

Note: If you have any other dependencies for your launch, use Rosdep or APT installs to install them.

## Upcoming_Features

1. ~~Support for Gazebo Classic~~ (COMPLETE) and test with different Ignition Gazebo Sim Versions
2. Support for additional scripts and nodes to be added in launch file

## Troubleshooting

1. ~~If you have meshes, make sure to launch from inside the src folder of your colcon workspace to view all the meshes on the simulator. For some reason, it is not showing up when launching from another directory~~ With the help of env-hooks, you can launch from anywhere you want as long as you are sourcing the workspace.

2. If you are spawning the robot with Gazebo Classic, make sure that the main urdf is of format .urdf and NOT .urdf.xacro as it'll cause some troubles while trying to parse it on Gazebo Classic. 
Just run the command after sourcing the description pkg of the robot to convert the .urdf.
xacro to just .urdf 

    ```bash
    ros2 run xacro xacro your_file.urdf.xacro > your_file.urdf
    ```

Then Copy THIS .urdf file into the ROS Autogen's urdf folder along with all the other files from the description pkg's urdf folder.

When running the main.py, make sure to point to this .urdf when asked about the path to the URDF.

There's no need to change anything with Ignition Gazebo as it can work with both .urdf and .urdf.xacro

